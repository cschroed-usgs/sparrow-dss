<?xml version="1.0" encoding="UTF-8"?>
<project name="sparrow_core" default="default" basedir=".">
    <description>Builds, tests, and runs the ${ant.project.name} project.</description>
    <import file="build-impl.xml" />
	
	<target name="-post-dist">
        <copy todir="${dist.dir}">
            <fileset dir="deploy" includes="mapviewer.war" />
            <globmapper from="mapviewer.war" to="sparrow_mv.war" />
        </copy>
        <copy todir="${dist.dir}">
            <fileset dir="deploy" includes="xmlparserv2.jar" />
            <globmapper from="xmlparserv2.jar" to="WEB-INF/lib/xmlparserv2.jar" />
        </copy>
		
		<unwar src="${dist.dir}/sparrow_mv.war" dest="${dist.dir}">
		    <patternset includes="**/mapViewerConfig.xml **/web.xml" />
			<globmapper from="*" to="*.tmp" />
		</unwar>

		<xslt in="${dist.dir}/WEB-INF/conf/mapViewerConfig.xml.tmp" out="${dist.dir}/WEB-INF/conf/mapViewerConfig.xml" style="ns-datasource-merge.xsl" />
		<xslt in="${dist.dir}/WEB-INF/web.xml.tmp" out="${dist.dir}/WEB-INF/web.xml" style="web-xml-merge.xsl">
			<param name="includeFile" expression="${build.web.dir}/WEB-INF/web.xml" />
		</xslt>
		
		<war destfile="${dist.dir}/sparrow_mv.war" update="true">
			<fileset dir="${dist.dir}" excludes="**/*.war **/*.tmp **/javadoc/**/*" />
            <fileset dir="${build.web.dir}" includes="WEB-INF/classes/**/*" />
		    <fileset dir="${build.web.dir}" includes="**/*.jar" excludes="**/mvclient.jar **/sdovis.jar **/commons*.jar" />
		</war>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}" excludes="**/*.war **/javadoc/**/*" />
		</delete>
	</target>
</project>